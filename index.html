#!/bin/bash
# --- Sulap Radio BlackTools Installer (Fixed Version) ---

# Text Colors
BLUE='\033[1;34m'
GREEN='\033[1;32m'
BOLD='\033[1m'
NC='\033[0m'

clear
echo -e "${BLUE}==========================================${NC}"
echo -e "${GREEN}    SULAP RADIO CUSTOM INSTALLER          ${NC}"
echo -e "${BLUE}==========================================${NC}"

# 1. Dependency Check (The part that caused the error)
echo -e "${BLUE}==>${NC} Detected System: Ubuntu"
echo -e "${BLUE}==>${NC} Installing dependencies..."
sudo apt-get update -qq && sudo apt-get install -y gcc make curl git tcl tcl-dev -qq

# 2. Interactive Questions
echo -e "${BLUE}==>${NC} Configuration Settings"
read -p "Enter Bot Nickname [sulap_bot]: " BOTNAME
BOTNAME=${BOTNAME:-sulap_bot}
read -p "Enter IRC Server [vancouver.bc.ca.undernet.org]: " SERVER
SERVER=${SERVER:-vancouver.bc.ca.undernet.org}
read -p "Enter Home Channel [#bislig]: " HOMECHAN
HOMECHAN=${HOMECHAN:-#bislig}

# 3. Build Eggdrop
BOTDIR="$HOME/$BOTNAME"
echo -e "${BLUE}==>${NC} Building Eggdrop in $BOTDIR..."
cd $HOME
wget -q https://ftp.eggheads.org/pub/eggdrop/source/1.10/eggdrop-1.10.1.tar.gz
tar -zxf eggdrop-1.10.1.tar.gz
cd eggdrop-1.10.1
./configure --prefix=$BOTDIR >/dev/null 2>&1
make config >/dev/null 2>&1
make -j$(nproc) >/dev/null 2>&1
make install >/dev/null 2>&1

# 4. Install BlackTools
echo -e "${BLUE}==>${NC} Cloning BlackTools from BlackShadow..."
cd $BOTDIR
git clone https://github.com/PHTLabs/BlackTools.git scripts/BlackTools >/dev/null
cp scripts/BlackTools/BlackTools.tcl scripts/BlackTools.tcl

# 5. Build the Config file
cat > "$BOTNAME.conf" <<EOF
set nick "$BOTNAME"
set altnick "$BOTNAME-"
set realname "https://sulapradio.com"
set servers { $SERVER:6667 }
loadmodule channels
loadmodule server
loadmodule irc
channel add $HOMECHAN {
  chanmode "+nt"
  idle-kick 0
}
source eggdrop.conf
source scripts/BlackTools.tcl
EOF

# 6. Shortcut Alias
# Check if alias already exists to avoid duplicates
if ! grep -q ".egg" ~/.bashrc; then
    echo "alias .egg='cd $BOTDIR && ./eggdrop -m $BOTNAME.conf'" >> ~/.bashrc
fi

echo -e "\n${GREEN}âœ… INSTALLATION COMPLETE!${NC}"
echo -e "Type ${BLUE}source ~/.bashrc${NC} then ${BLUE}.egg${NC} to start your bot."
