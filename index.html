#!/bin/bash
# --- Sulap Radio BlackTools Installer (STABLE) ---

BLUE='\033[1;34m'
GREEN='\033[1;32m'
BOLD='\033[1m'
NC='\033[0m'

clear
echo -e "${BLUE}==========================================${NC}"
echo -e "${GREEN}    SULAP RADIO CUSTOM INSTALLER          ${NC}"
echo -e "${BLUE}==========================================${NC}"

# 1. Dependency Check
echo -e "${BLUE}==>${NC} Installing dependencies..."
sudo apt-get update -qq && sudo apt-get install -y gcc make curl git tcl tcl-dev -qq

# 2. Interactive Questions (CLEANED UP)
echo -e "${BLUE}==>${NC} Configuration Settings"
printf "Enter Bot Nickname [sulap_bot]: "
read BOTNAME
BOTNAME=${BOTNAME:-sulap_bot}

printf "Enter IRC Server [vancouver.bc.ca.undernet.org]: "
read SERVER
SERVER=${SERVER:-vancouver.bc.ca.undernet.org}

printf "Enter Home Channel [#bislig]: "
read HOMECHAN
HOMECHAN=${HOMECHAN:-#bislig}

# 3. Setup Directories
BOTDIR="$HOME/$BOTNAME"
echo -e "${BLUE}==>${NC} Building Eggdrop in: $BOTDIR"

# 4. Build Eggdrop
cd $HOME
wget -q https://ftp.eggheads.org/pub/eggdrop/source/1.10/eggdrop-1.10.1.tar.gz
tar -zxf eggdrop-1.10.1.tar.gz
cd eggdrop-1.10.1
./configure --prefix=$BOTDIR >/dev/null 2>&1
make config >/dev/null 2>&1
make -j$(nproc) >/dev/null 2>&1
make install >/dev/null 2>&1

# 5. Install BlackTools (Public Repo Fix)
echo -e "${BLUE}==>${NC} Cloning BlackTools..."
mkdir -p $BOTDIR/scripts
cd $BOTDIR/scripts
git clone https://github.com/PHTLabs/BlackTools.git >/dev/null 2>&1
cp BlackTools/BlackTools.tcl $BOTDIR/scripts/BlackTools.tcl

# 6. Build Config
cat > "$BOTDIR/$BOTNAME.conf" <<EOF
set nick "$BOTNAME"
set altnick "$BOTNAME-"
set realname "https://sulapradio.com"
set servers { $SERVER:6667 }
loadmodule channels
loadmodule server
loadmodule irc
channel add $HOMECHAN {
  chanmode "+nt"
  idle-kick 0
}
source eggdrop.conf
source scripts/BlackTools.tcl
EOF

# 7. Shortcut Alias
if ! grep -q ".egg" ~/.bashrc; then
    echo "alias .egg='cd $BOTDIR && ./eggdrop -m $BOTNAME.conf'" >> ~/.bashrc
fi

echo -e "\n${GREEN}âœ… INSTALLATION FINISHED SUCCESSFULLY!${NC}"
echo -e "Type ${BLUE}source ~/.bashrc${NC} then ${BLUE}.egg${NC} to start."
